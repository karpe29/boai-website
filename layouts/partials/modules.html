{{/* BrandDNA Module */}}
{{ partial "module-section.html" (dict 
        "title" "BrandDNA"
        "subtitle" "Understand and maintain your brand's unique identity across all creatives"
        "tabs" (slice
        (dict "title" "Brand Analysis" "description" "Analyze and understand your brand's unique DNA to create consistent, on-brand creatives." "icon" "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" "start" 0 "end" 4)
        (dict "title" "Consistency Check" "description" "Ensure all creatives maintain brand consistency across platforms and campaigns." "icon" "M12 4v16m8-8H4" "start" 4 "end" 8)
    )
    "videoSrc" "/videos/demoVideo.mp4"
    "moduleId" "branddna"
    "bgClass" "bg-primary"
    "bgClassAlt" "bg-primary-dark"
) }}

{{/* Script Module */}}
{{ partial "module-section.html" (dict 
    "title" "Script Module"
    "subtitle" "Generate compelling scripts that convert with AI-powered writing"
    "tryButton" (dict "text" "Try Now" "url" "#contact")
    "tabs" (slice
        (dict "title" "Script Generation" "description" "Generate compelling scripts that convert. AI-powered script writing that understands your brand voice." "icon" "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" "start" 0 "end" 4)
        (dict "title" "Voice Optimization" "description" "Optimize scripts for different audiences while maintaining your unique brand voice." "icon" "M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" "start" 4 "end" 8)
        (dict "title" "A/B Testing" "description" "Test multiple script variations to find what resonates best with your audience." "icon" "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" "start" 8 "end" 12)
    )
    "videoSrc" "/videos/demoVideo.mp4"
    "moduleId" "script"
    "bgClass" "bg-primary-dark"
    "bgClassAlt" "bg-primary"
) }}

{{/* VisualLab Module */}}
{{ partial "module-section.html" (dict 
        "title" "VisualLab"
        "subtitle" "Create stunning visuals at scale while maintaining brand consistency"
        "tabs" (slice
        (dict "title" "Visual Generation" "description" "Create stunning visuals at scale. AI-powered visual generation that maintains brand consistency." "icon" "M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" "start" 0 "end" 5)
        (dict "title" "Style Matching" "description" "Automatically match visual styles across all your creatives for cohesive brand presentation." "icon" "M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" "start" 5 "end" 10)
    )
    "videoSrc" "/videos/demoVideo.mp4"
    "moduleId" "visuallab"
    "bgClass" "bg-primary"
    "bgClassAlt" "bg-primary-dark"
) }}

{{/* MasterCut Module */}}
{{ partial "module-section.html" (dict 
        "title" "MasterCut"
        "subtitle" "Professional video editing at scale with AI-powered precision"
        "tabs" (slice
        (dict "title" "Smart Editing" "description" "Professional video editing at scale. AI-powered cutting and editing for perfect pacing and flow." "icon" "M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" "start" 0 "end" 6)
    )
    "videoSrc" "/videos/demoVideo.mp4"
    "moduleId" "mastercut"
    "bgClass" "bg-primary-dark"
    "bgClassAlt" "bg-primary"
) }}

{{/* VariantEngine Module */}}
{{ partial "module-section.html" (dict 
        "title" "VariantEngine"
        "subtitle" "Generate unlimited creative variants and scale what works"
        "tabs" (slice
        (dict "title" "Variant Generation" "description" "Generate unlimited creative variants automatically. Test more, learn faster, and scale what works." "icon" "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" "start" 0 "end" 4)
        (dict "title" "Performance Tracking" "description" "Track which variants perform best and automatically scale winning creatives." "icon" "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" "start" 4 "end" 8)
        (dict "title" "Auto-Scaling" "description" "Automatically scale high-performing variants across all your ad platforms." "icon" "M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" "start" 8 "end" 12)
    )
    "videoSrc" "/videos/demoVideo.mp4"
    "moduleId" "variantengine"
    "bgClass" "bg-primary"
    "bgClassAlt" "bg-primary-dark"
) }}

<script>
// Initialize all modules with synchronized tab/video functionality
document.addEventListener('DOMContentLoaded', function() {
    const modules = ['branddna', 'script', 'visuallab', 'mastercut', 'variantengine'];
    
    modules.forEach(moduleName => {
        const video = document.querySelector(`video[data-module="${moduleName}"]`);
        const tabContainer = document.querySelector(`[data-module="${moduleName}"]`);
        const tabs = tabContainer ? tabContainer.querySelectorAll('.module-tab') : [];
        const progressBar = video ? video.closest('.relative').querySelector('.progress-bar') : null;
        const playPauseBtn = video ? video.closest('.relative').querySelector('.play-pause-btn') : null;
        const playIcon = playPauseBtn ? playPauseBtn.querySelector('.play-icon') : null;
        const pauseIcon = playPauseBtn ? playPauseBtn.querySelector('.pause-icon') : null;
        
        if (!video || tabs.length === 0 || !progressBar || !playPauseBtn) return;
        
        let currentActiveTab = 0;
        let isPlaying = false;
        let progress = 0;
        let progressInterval = null;
        
        function updateActiveTab(index) {
            tabs.forEach((tab, i) => {
                const icon = tab.querySelector('div:first-child');
                const title = tab.querySelector('h3');
                const underline = tab.querySelector('.absolute.bottom-0');
                
                if (i === index) {
                    tab.setAttribute('aria-selected', 'true');
                    tab.classList.remove('text-gray-400', 'hover:text-white', 'bg-primary-dark');
                    tab.classList.add('text-white', 'bg-primary');
                    icon.classList.remove('bg-primary', 'text-gray-500');
                    icon.classList.add('bg-accent/20', 'text-accent');
                    title.classList.remove('text-gray-300');
                    title.classList.add('text-white');
                    if (underline) underline.classList.remove('hidden');
                } else {
                    tab.setAttribute('aria-selected', 'false');
                    tab.classList.remove('text-white', 'bg-primary');
                    tab.classList.add('text-gray-400', 'hover:text-white', 'bg-primary-dark');
                    icon.classList.remove('bg-accent/20', 'text-accent');
                    icon.classList.add('bg-primary', 'text-gray-500');
                    title.classList.remove('text-white');
                    title.classList.add('text-gray-300');
                    if (underline) underline.classList.add('hidden');
                }
            });
        }
        
        function changeChapter(index) {
            currentActiveTab = index;
            const tab = tabs[index];
            const start = parseFloat(tab.getAttribute('data-start'));
            const end = parseFloat(tab.getAttribute('data-end'));
            
            video.pause();
            video.currentTime = start;
            progress = 0;
            progressBar.style.width = '0%';
            
            updateActiveTab(index);
            
            // Auto-play when tab is clicked
            setTimeout(() => {
                video.play();
                isPlaying = true;
                if (playIcon) playIcon.classList.add('hidden');
                if (pauseIcon) pauseIcon.classList.remove('hidden');
                if (playPauseBtn) playPauseBtn.setAttribute('aria-label', 'Pause feature demo');
                startProgressAnimation();
            }, 100);
        }
        
        function startProgressAnimation() {
            if (progressInterval) clearInterval(progressInterval);
            
            const activeTab = tabs[currentActiveTab];
            const start = parseFloat(activeTab.getAttribute('data-start'));
            const end = parseFloat(activeTab.getAttribute('data-end'));
            const duration = end - start;
            
            const interval = 50;
            
            progressInterval = setInterval(() => {
                if (isPlaying && video.currentTime < end) {
                    const currentProgress = ((video.currentTime - start) / duration) * 100;
                    progress = Math.min(currentProgress, 100);
                    progressBar.style.width = progress + '%';
                } else if (video.currentTime >= end) {
                    progress = 100;
                    progressBar.style.width = '100%';
                    clearInterval(progressInterval);
                    // Auto-advance will be handled by timeupdate event
                }
            }, interval);
        }
        
        function togglePlayPause() {
            if (isPlaying) {
                video.pause();
                isPlaying = false;
                if (playIcon) playIcon.classList.remove('hidden');
                if (pauseIcon) pauseIcon.classList.add('hidden');
                playPauseBtn.setAttribute('aria-label', 'Play feature demo');
                if (progressInterval) clearInterval(progressInterval);
            } else {
                video.play();
                isPlaying = true;
                if (playIcon) playIcon.classList.add('hidden');
                if (pauseIcon) pauseIcon.classList.remove('hidden');
                playPauseBtn.setAttribute('aria-label', 'Pause feature demo');
                startProgressAnimation();
            }
        }
        
        tabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                // Always auto-play when tab is clicked
                changeChapter(index);
            });
        });
        
        if (playPauseBtn) {
            playPauseBtn.addEventListener('click', togglePlayPause);
        }
        
        video.addEventListener('play', () => {
            isPlaying = true;
            if (playIcon) playIcon.classList.add('hidden');
            if (pauseIcon) pauseIcon.classList.remove('hidden');
            if (playPauseBtn) playPauseBtn.setAttribute('aria-label', 'Pause feature demo');
            startProgressAnimation();
        });
        
        video.addEventListener('pause', () => {
            isPlaying = false;
            if (playIcon) playIcon.classList.remove('hidden');
            if (pauseIcon) pauseIcon.classList.add('hidden');
            if (playPauseBtn) playPauseBtn.setAttribute('aria-label', 'Play feature demo');
            if (progressInterval) clearInterval(progressInterval);
        });
        
        video.addEventListener('timeupdate', () => {
            const activeTab = tabs[currentActiveTab];
            const start = parseFloat(activeTab.getAttribute('data-start'));
            const end = parseFloat(activeTab.getAttribute('data-end'));
            
            // Auto-advance to next tab when current chapter ends
            if (video.currentTime >= end && isPlaying) {
                // Clear progress interval
                if (progressInterval) clearInterval(progressInterval);
                
                // Move to next tab (auto-plays via changeChapter)
                if (currentActiveTab < tabs.length - 1) {
                    changeChapter(currentActiveTab + 1);
                } else {
                    // Loop back to first tab
                    changeChapter(0);
                }
            }
        });
        
        updateActiveTab(0);
    });
});
</script>
